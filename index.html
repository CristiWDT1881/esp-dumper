<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP32 Flash Dumper & Writer</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Arial,sans-serif;background-color:#1a5f3f;min-height:100vh;padding:20px;display:flex;flex-direction:column;align-items:center}
.header-images{display:flex;justify-content:space-between;align-items:flex-start;width:100%;max-width:700px;margin-bottom:40px}
.header-images img{max-width:180px;height:auto;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,.3);border:4px solid #5B9BD5}
.container{max-width:700px;width:100%}
h1{color:#FFD700;font-size:2.5em;text-align:center;margin:20px 0;text-shadow:2px 2px 4px rgba(0,0,0,.3)}
.section{background:#B3D9F2;border-radius:15px;padding:20px;margin-bottom:15px;box-shadow:0 8px 30px rgba(0,0,0,.3);border:4px solid #5B9BD5}
.section.first-box{display:flex;gap:20px;align-items:flex-start;padding:10px 20px}
.section-content{flex:1}.signature-img{width:130px;height:auto;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,.2);border:4px solid #5B9BD5}
.section h2{color:#1a5f3f;font-size:1.3em;margin-bottom:10px}
.section p{color:#000;font-size:.95em;margin-bottom:5px}
.control-group{margin-bottom:10px}
.control-group label{color:#1a5f3f;font-weight:bold;display:block;margin-bottom:5px}
select,input[type=file]{width:100%;padding:8px;border:3px solid #5B9BD5;border-radius:8px;background:#fff}
.button-group{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
button{flex:1;min-width:180px;padding:12px;font-size:1.1em;font-weight:bold;border:none;border-radius:12px;cursor:pointer;transition:.3s;box-shadow:0 6px 20px rgba(0,0,0,.3)}
.btn-connect{background:#1a5f3f;color:#fff}.btn-connect:hover{background:#145030;transform:translateY(-2px)}
.btn-disconnect{background:#6c757d;color:#fff}
.btn-read,.btn-write{background:#5B9BD5;color:#000}
.btn-read:hover,.btn-write:hover{background:#FFD700;transform:translateY(-2px)}
button:disabled{opacity:.5;cursor:not-allowed;transform:none!important}
.status{background:#fff;padding:10px;border-radius:8px;margin-bottom:10px;border:3px solid #5B9BD5;font-weight:500}
.status.connected{border-color:#1a5f3f;background:#d4edda}
.status.working{border-color:#FFD700;background:#fff3cd}
.status.error{border-color:#dc3545;background:#f8d7da}
.info-box{background:#fff;padding:10px;border-radius:8px;margin-top:10px;border:3px solid #5B9BD5;font-size:.9em}
.info-box strong{color:#1a5f3f}
.progress-bar{width:100%;height:30px;background:#fff;border-radius:8px;border:3px solid #5B9BD5;overflow:hidden;margin:10px 0;display:none}
.progress-bar.active{display:block}
.progress-fill{height:100%;background:linear-gradient(90deg,#1a5f3f,#5B9BD5);width:0%;transition:.3s;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold}
.log-container{background:#1e1e1e;color:#0f0;padding:15px;border-radius:8px;max-height:400px;overflow-y:auto;font-family:'Courier New',monospace;font-size:.9em;line-height:1.6}
.log-entry{margin-bottom:3px}.log-entry.error{color:#ff6b6b}.log-entry.success{color:#51cf66}.log-entry.warning{color:#ffd43b}.log-entry.info{color:#74c0fc}
.radio-links{display:flex;justify-content:space-around;align-items:center;gap:30px;flex-wrap:wrap}
.radio-link{display:flex;flex-direction:column;align-items:center;text-decoration:none;transition:.3s}
.radio-link:hover{transform:scale(1.1)}.radio-link img{width:120px;height:120px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.2);margin-bottom:10px;border:4px solid #5B9BD5}
.radio-link span{color:#000;font-weight:bold;font-size:1.1em}
</style>
</head>
<body>
<div class="header-images">
<img src="./palatiasi.png"><img src="./logo.png"></div>
<div class="container">
<h1>ESP32 Flash Dumper & Writer</h1>
<div class="section first-box"><div class="section-content">
<h2>üì° Connect Device</h2>
<div id="status" class="status">Status: Disconnected</div>
<div id="deviceInfo" class="info-box" style="display:none"><strong>Chip:</strong> <span id="chipType">-</span><br><strong>Flash Size:</strong> <span id="flashSize">-</span><br><strong>MAC Address:</strong> <span id="macAddress">-</span></div>
<div class="button-group"><button id="connectBtn" class="btn-connect">CONNECT</button><button id="disconnectBtn" class="btn-disconnect" disabled>DISCONNECT</button></div>
</div><img src="./semnatura.png" class="signature-img"></div>
<div class="section"><h2>üì• Happy Read - Dump Flash</h2><p><strong>1.</strong> Connect device</p><p><strong>2.</strong> Click HAPPY READ</p><div class="button-group"><button id="dumpBtn" class="btn-read" disabled>üì• HAPPY READ</button></div><div id="dumpProgress" class="progress-bar"><div id="dumpProgressFill" class="progress-fill">0%</div></div></div>
<div class="section"><h2>‚òÅÔ∏è Happy Backup Dump on GitHub</h2><div class="button-group"><button id="githubBackupBtn" class="btn-write" disabled>‚òÅÔ∏è HAPPY BACKUP DUMP ON GITHUB</button></div><div id="githubProgress" class="progress-bar"><div id="githubProgressFill" class="progress-fill">0%</div></div></div>
<div class="section"><h2>üì§ Happy Write - Write Flash</h2><div class="control-group"><label>Select Firmware File:</label><input type="file" id="writeFile" accept=".bin"></div><div class="button-group"><button id="writeBtn" class="btn-write" disabled>üì§ HAPPY WRITE</button></div><div id="writeProgress" class="progress-bar"><div id="writeProgressFill" class="progress-fill">0%</div></div></div>
<div class="section"><h2>üìã Operation Log</h2><div id="logContainer" class="log-container"><div class="log-entry info">System initialized. Connect device to start...</div></div></div>
<div class="section"><h2>üìª Radio Live</h2><div class="radio-links"><a href="https://www.radioromaniacultural.ro/live/" class="radio-link"><img src="./logocultural.svg"><span>Cultural</span></a><a href="http://player.radioiasi.ro/live-radio-iasi.html" class="radio-link"><img src="./logoriasi.svg"><span>Radio Ia»ôi</span></a></div></div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script type="module">
import { ESPLoader, Transport } from 'https://unpkg.com/esptool-js@0.4.5/bundle.js';

// original vars... (omitted here to save space)

async function happyWrite() {
            if (!state.connected || state.isOperating) return;
            const file = el.writeFile.files[0];
            if (!file) { alert('Select file!'); return; }

            const fileSize = file.size;
            const flashBytes = state.detectedFlashSize * 1024 * 1024;
            if (fileSize !== flashBytes && !confirm(`‚ö†Ô∏è File size (${(fileSize/1024/1024).toFixed(2)}MB) != Flash size (${state.detectedFlashSize}MB). Continue?`)) return;
            if (!confirm(`‚ö†Ô∏è FULL ERASE + WRITE ${state.detectedFlashSize}MB flash?`)) return;

            try {
                state.isOperating = true;
                el.dumpBtn.disabled = true;
                el.writeBtn.disabled = true;
                el.githubBackupBtn.disabled = true;
                updateStatus('üì§ Writing...', 'working');
                log('Reading firmware...', 'info');

                const buf = await file.arrayBuffer();
                const data = new Uint8Array(buf);
                log(`Loaded ${(data.length/1024/1024).toFixed(2)}MB`, 'success');

                log('Erasing flash...', 'warning');
                updateProgress(el.writeProgress, el.writeProgressFill, 0, 'Erasing...');
                await state.esploader.eraseFlash();
                log('‚úÖ Flash erased', 'success');

                log('Writing raw flash image @0x0...', 'info');
                await state.esploader.writeFlash({
                    fileArray:[{ data: buf, address: 0x0 }],
                    flashSize: 'keep',
                    eraseAll: false,
                    compress: false,
                    reportProgress:(i,w,t)=>{
                        const pct = Math.floor(w/t*100);
                        const mbW = (w/1024/1024).toFixed(2);
                        const mbT = (t/1024/1024).toFixed(2);
                        updateProgress(el.writeProgress, el.writeProgressFill, pct, `${pct}% - ${mbW}/${mbT}MB`);
                        if(pct%10===0) log(`Writing: ${pct}% (${mbW}MB)`, 'info');
                    }
                });

                updateProgress(el.writeProgress, el.writeProgressFill, 100, 'Done');
                log('‚úÖ Flash write complete!', 'success');
                updateStatus('‚úÖ Write Complete!', 'connected');
                setTimeout(()=>hideProgress(el.writeProgress),3000);

            } catch(e) {
                log(`‚ùå ${e.message}`, 'error');
                updateStatus('‚ùå Write Failed', 'error');
                hideProgress(el.writeProgress);
                alert(e.message);
            } finally {
                state.isOperating = false;
                el.dumpBtn.disabled = false;
                el.writeBtn.disabled = false;
                el.githubBackupBtn.disabled = false;
            }
        });
        updateStatus('‚úÖ Write Complete!','connected');
    }catch(e){updateStatus('‚ùå Write Failed','error');alert(e.message);}finally{
        state.isOperating=false; el.dumpBtn.disabled=false; el.writeBtn.disabled=false; el.githubBackupBtn.disabled=false;
    }
}
</script>
</body>
</html>
